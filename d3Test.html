<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script type="text/javascript" src="data.json"></script>
</head>

<body>

  <svg width="100%" height="800px"></svg>

  <script>

    let svg = d3.select('svg');

    let propertyToColor = "category"; // e4.3
    let uniquePropertyValues = d3.map(data, d=>d[propertyToColor]).keys();
    let colorScale = d3.scaleOrdinal(d3.schemeCategory20);
    let binIndexByProperty = {};

    // e4.1
    for (let prop of uniquePropertyValues) {
        binIndexByProperty[prop] = 0;
    }
    console.log(binIndexByProperty)


    // e2
    let dataRects = svg.selectAll('.dataRects')
        .data(data);

    let dataRectsEntered = dataRects
        .enter()
        .append('rect')
        .classed('dataRects', true)
        .attr('width', 2) // e2.3
        .attr('height', 20)
        .attr('fill', 'white')
        .attr('x', 0)
        .attr('y', 0)

    dataRects = dataRects.merge(dataRectsEntered);

    dataRects
        .transition()
        .duration(1000)
        .delay((d,i)=>i*10)
        .attr('x', (d,i) => i*2) // e2.2
        //       .attr('y', (d,i) => 80) // e2.1
         .attr('y', (d,i) => uniquePropertyValues.indexOf(d[propertyToColor]) * 25) // e3.2
         // e2.4
        .attr('fill', d=>colorScale(uniquePropertyValues.indexOf(d[propertyToColor])))

         // e4.1
         .transition()
         .delay(data.length * 10)
         .attr('x',(d,i) => {
            binIndexByProperty[d[propertyToColor]]++;
            return binIndexByProperty[d[propertyToColor]] * 2;
          });

     // e3.3
    svg.selectAll('text')
         .data(uniquePropertyValues)
         .enter()
         .append('text')
         .attr('x', data.length * 2 + 10)
         .attr('y', (d,i)=>i*25 + 14)
         .text(d=>d + ' (' + binIndexByProperty[d] + ')') //e4.2

         // e4.1
         .transition()
         .delay(1000 + data.length * 10 * 2)
         .duration(1000)
         .attr('x',(d,i) => {
            return binIndexByProperty[d] * 2 + 10;
         });
  </script>

	<style>
    body {
      margin: 20px;
    }
    ul > li {
      font-weight: bold;
      margin: 5px 0px;
    }
    ol li {
      font-weight: normal;
      margin-bottom: 0px;
    }
    ol li label {
      cursor: pointer;
    }

    input:checked~.exercise {
      text-decoration: line-through;
    }

	</style>
</body>
